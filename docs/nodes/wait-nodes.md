# 대기 노드 (Wait Nodes)

대기 노드는 워크플로우 실행을 일정 시간 동안 일시 중지하는 노드입니다.

## 구현된 노드

### wait (대기 노드)

지정된 시간만큼 워크플로우 실행을 일시 중지하는 노드입니다.

**파일 위치**: `server/nodes/waitnodes/wait.py`

**노드 타입**: `wait`

**설명**: 지정된 시간(초)만큼 비동기적으로 대기합니다. 다른 작업을 블로킹하지 않으면서 실행을 일시 중지합니다.

#### 파라미터

- `wait_time` (number, 기본값: 1, 필수): 대기할 시간을 초 단위로 지정합니다.
  - 최소값: 0
  - 최대값: 3600 (1시간)
  - 음수 값은 자동으로 0으로 설정됩니다
  - 숫자로 변환할 수 없는 값은 기본값 1을 사용합니다

#### 출력 스키마

```json
{
  "action": "wait",
  "wait_time": 1.5,
  "status": "completed",
  "message": "1.5초 대기 완료",
  "output": {
    "wait_time": 1.5
  }
}
```

#### 동작 방식

1. **파라미터 추출 및 검증**
   - `wait_time` 파라미터를 추출합니다
   - 값이 `None`이면 기본값 1을 사용합니다
   - 값을 `float`로 변환 시도합니다
   - 변환 실패 시 기본값 1을 사용합니다
   - 음수 값은 0으로 설정됩니다

2. **비동기 대기**
   - `asyncio.sleep(wait_time)`을 사용하여 비동기적으로 대기합니다
   - 이는 다른 작업을 블로킹하지 않으면서 지정된 시간만큼 실행을 일시 중지합니다

3. **결과 반환**
   - 대기 시간과 완료 메시지를 포함한 결과를 반환합니다

#### 코드 예시

```python
@NodeExecutor("wait")
async def execute(parameters: dict[str, Any]) -> dict[str, Any]:
    # wait_time 추출 및 검증
    wait_time_raw = get_parameter(parameters, "wait_time", default=1)
    if wait_time_raw is None:
        wait_time_raw = 1
    
    try:
        wait_time = float(wait_time_raw)
        if wait_time < 0:
            wait_time = 0
    except (ValueError, TypeError):
        wait_time = 1
    
    # 비동기 대기
    await asyncio.sleep(wait_time)
    
    return {
        "action": "wait",
        "wait_time": wait_time,
        "status": "completed",
        "message": f"{wait_time}초 대기 완료",
        "output": {"wait_time": wait_time},
    }
```

#### 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────────────────┐
│                    클라이언트 요청                           │
│              (워크플로우 실행 중 wait 노드 도달)              │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────┐
│              API 라우터 (action_router.py)                   │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────┐
│              ActionService.process_node()                    │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────┐
│              NodeExecutor 래퍼                               │
│  - 파라미터 검증                                             │
│  - 에러 처리                                                 │
│  - 로깅                                                      │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────┐
│              WaitNode.execute()                              │
│                                                              │
│  1. wait_time 파라미터 추출 및 검증                          │
│     - 기본값 처리 (None → 1)                                 │
│     - 타입 변환 (float)                                      │
│     - 음수 값 처리 (→ 0)                                     │
│                                                              │
│  2. asyncio.sleep(wait_time) 실행                            │
│     - 비동기 대기 (다른 작업 블로킹하지 않음)                │
│                                                              │
│  3. 결과 반환                                                │
│     - wait_time, status, message 포함                        │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────┐
│              표준 형식 결과 반환                             │
│  {                                                           │
│    "action": "wait",                                        │
│    "wait_time": 1.5,                                        │
│    "status": "completed",                                   │
│    "message": "1.5초 대기 완료",                            │
│    "output": {"wait_time": 1.5}                            │
│  }                                                           │
└─────────────────────────────────────────────────────────────┘
```

#### 주요 특징

- **비동기 실행**: `asyncio.sleep()`을 사용하여 다른 작업을 블로킹하지 않습니다
- **유연한 파라미터 처리**: 다양한 타입의 입력을 자동으로 처리하고 기본값을 제공합니다
- **안전한 검증**: 음수 값이나 잘못된 타입을 자동으로 처리합니다
- **로깅**: 대기 시작과 완료 시점을 로그에 기록합니다

#### 사용 예시

**기본 사용 (1초 대기)**
```json
{
  "node_type": "wait",
  "parameters": {}
}
```

**5초 대기**
```json
{
  "node_type": "wait",
  "parameters": {
    "wait_time": 5
  }
}
```

**0.5초 대기 (소수점 지원)**
```json
{
  "node_type": "wait",
  "parameters": {
    "wait_time": 0.5
  }
}
```

**워크플로우에서의 사용**
```
[시작] → [클릭] → [대기 2초] → [이미지 터치] → [대기 1초] → [종료]
```

이 예시에서 클릭 후 2초 대기한 다음 이미지 터치를 수행하고, 다시 1초 대기한 후 종료합니다.

#### 주의사항

- **최대 대기 시간**: 기본적으로 최대 3600초(1시간)까지 설정 가능합니다
- **정확도**: `asyncio.sleep()`은 시스템의 타이머 정확도에 의존합니다
- **비동기 컨텍스트**: 이 노드는 반드시 비동기 컨텍스트에서 실행되어야 합니다
- **워크플로우 일시 중지**: 대기 중에는 워크플로우 실행이 일시 중지되지만, 다른 비동기 작업은 계속 실행될 수 있습니다
